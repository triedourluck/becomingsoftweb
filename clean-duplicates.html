<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Limpiar duplicados</title>
</head>
<body>

<h2>Limpiando duplicados...</h2>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyCbhjiiQ8ej5yu6LqLPb57XwrFlubFZyvA",
  authDomain:"becomingsoft-84e72.firebaseapp.com",
  projectId:"becomingsoft-84e72",
  storageBucket:"becomingsoft-84e72.firebasestorage.app",
  messagingSenderId:"605759003962",
  appId:"1:605759003962:web:ea8603a8e97e42d2278403"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function cleanDuplicates(){

  const snap = await getDocs(collection(db,"posts"));

  const seen = {};
  let deletedCount = 0;

  for(const postDoc of snap.docs){

    const data = postDoc.data();

    const key = `${data.text}_${data.authorUid}_${data.createdAt?.seconds || data.createdAt}`;

    if(seen[key]){
      await deleteDoc(doc(db,"posts",postDoc.id));
      deletedCount++;
      console.log("Eliminado:", postDoc.id);
    }else{
      seen[key] = true;
    }
  }

  console.log("âœ¨ Limpieza terminada.");
  console.log("Posts eliminados:", deletedCount);
  alert("Limpieza completada. Revisa la consola.");
}

cleanDuplicates();
</script>

</body>
</html>