<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyCbhjiiQ8ej5yu6LqLPb57XwrFlubFZyvA",
  authDomain:"becomingsoft-84e72.firebaseapp.com",
  projectId:"becomingsoft-84e72",
  storageBucket:"becomingsoft-84e72.firebasestorage.app",
  messagingSenderId:"605759003962",
  appId:"1:605759003962:web:ea8603a8e97e42d2278403"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function cleanDuplicates(){

  const snap = await getDocs(collection(db,"posts"));
  const groups = {};
  let deleted = 0;

  for(const postDoc of snap.docs){
    const data = postDoc.data();

    const normalizedText = (data.text || "").trim().toLowerCase();

    const key = `${normalizedText}_${data.authorUid}_${data.senderUid}`;

    if(!groups[key]){
      groups[key] = [];
    }

    groups[key].push(postDoc);
  }

  for(const key in groups){
    const posts = groups[key];

    if(posts.length > 1){

      // dejamos el primero y borramos el resto
      for(let i = 1; i < posts.length; i++){
        await deleteDoc(doc(db,"posts",posts[i].id));
        deleted++;
        console.log("Eliminado:", posts[i].id);
      }
    }
  }

  alert(`âœ¨ Eliminados ${deleted} duplicados`);
}

cleanDuplicates();
</script>