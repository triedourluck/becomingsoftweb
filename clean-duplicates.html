<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyCbhjiiQ8ej5yu6LqLPb57XwrFlubFZyvA",
  authDomain:"becomingsoft-84e72.firebaseapp.com",
  projectId:"becomingsoft-84e72",
  storageBucket:"becomingsoft-84e72.firebasestorage.app",
  messagingSenderId:"605759003962",
  appId:"1:605759003962:web:ea8603a8e97e42d2278403"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function cleanDuplicates(){

  const q = query(
    collection(db,"posts"),
    orderBy("createdAt","desc")
  );

  const snap = await getDocs(q);

  let lastKey = null;
  let deletedCount = 0;

  for(const postDoc of snap.docs){

    const data = postDoc.data();
    const key = `${data.text}_${data.authorUid}_${data.senderAlias}`;

    if(key === lastKey){
      await deleteDoc(doc(db,"posts",postDoc.id));
      deletedCount++;
      console.log("Eliminado:", postDoc.id);
    }

    lastKey = key;
  }

  alert(`âœ¨ Limpieza completada. Eliminados: ${deletedCount}`);
}

cleanDuplicates();
</script>